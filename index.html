<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificador de Máquinas</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        h1 {
            text-align: center;
        }

        #controls {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        #addMachineBtn {
            padding: 8px 15px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #007bff;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
        }
        #addMachineBtn:hover {
            background-color: #0056b3;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            table-layout: fixed;
            user-select: none; /* Evita la selección de texto al hacer clic */
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
            height: 20px; /* Altura de fila fija para representar minutos */
        }

        th {
            background-color: #f2f2f2;
        }
        
        /* Estilo para la primera columna de tiempo */
        td:first-child, th:first-child {
            background-color: #e9ecef;
            font-weight: bold;
            width: 60px; /* Ancho fijo para la columna de tiempo */
        }

        /* Estilo para la celda de estado inactivo/espera */
        .estado-inactivo {
            background-color: #fce8e6; /* Un rojo muy claro de fondo */
            background-image: repeating-linear-gradient(
                45deg,
                #f7c5c0,
                #f7c5c0 8px,
                transparent 8px,
                transparent 16px
            );
        }
    </style>
</head>
<body>

    <h1>Planificador de Tareas por Minuto</h1>

    <div id="controls">
        <button id="addMachineBtn">+ máquina</button>
    </div>

    <table id="scheduleTable">
        <thead>
            <tr>
                </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <script>
        const table = document.getElementById('scheduleTable');
        const TOTAL_MINUTOS = 60; // Total de filas a generar (ej: 60 minutos)
        const INITIAL_MACHINES = 2; // Cantidad inicial de máquinas

        /**
         * Función para crear la tabla inicial al cargar la página
         */
        function createInitialGrid() {
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');

            // 1. Crear encabezados
            let headers = '<th>Minuto</th>';
            for (let i = 1; i <= INITIAL_MACHINES; i++) {
                headers += `<th>Máquina ${i}</th>`;
            }
            thead.innerHTML = headers;

            // 2. Crear filas de minutos
            for (let i = 0; i < TOTAL_MINUTOS; i++) {
                const row = document.createElement('tr');
                // Añadir celda de tiempo
                let rowContent = `<td>${i}</td>`;
                // Añadir celdas para máquinas
                for (let j = 0; j < INITIAL_MACHINES; j++) {
                    rowContent += '<td></td>';
                }
                row.innerHTML = rowContent;
                tbody.appendChild(row);
            }
        }

        /**
         * Lógica para el botón "+ máquina"
         */
        document.getElementById('addMachineBtn').addEventListener('click', function() {
            const headerRow = table.querySelector('thead tr');
            const newMachineNumber = headerRow.cells.length; // El nuevo número es el total de columnas actual

            // Añadir encabezado para la nueva máquina
            const newHeader = document.createElement('th');
            newHeader.textContent = `Máquina ${newMachineNumber}`;
            headerRow.appendChild(newHeader);

            // Añadir una celda vacía en cada fila para la nueva máquina
            const bodyRows = table.querySelectorAll('tbody tr');
            bodyRows.forEach(row => {
                const newCell = document.createElement('td');
                row.appendChild(newCell);
            });
        });

        /**
         * Lógica principal para manejar los clics en las celdas de la tabla
         */
        table.addEventListener('click', function(event) {
            const clickedCell = event.target;

            // Asegurarse de que se hizo clic en una celda (TD)
            if (clickedCell.tagName !== 'TD') {
                return;
            }

            const colIndex = clickedCell.cellIndex;
            
            // IGNORAR clics en la primera columna (la de los minutos)
            if (colIndex === 0) {
                return;
            }

            const rowIndex = clickedCell.parentElement.rowIndex - 1; // -1 para ajustar por el thead
            const allRows = Array.from(table.querySelectorAll('tbody tr'));

            // LÓGICA DE AUTOCOMPLETAR ESPACIOS VACÍOS
            // Si la celda está vacía (sin color y sin clase inactivo)
            if (!clickedCell.style.backgroundColor && !clickedCell.classList.contains('estado-inactivo')) {
                let prevTaskRow = -1;
                let nextTaskRow = -1;

                // Buscar hacia arriba la tarea anterior en la misma columna
                for (let i = rowIndex - 1; i >= 0; i--) {
                    if (allRows[i].cells[colIndex].style.backgroundColor || allRows[i].cells[colIndex].classList.contains('estado-inactivo')) {
                        prevTaskRow = i;
                        break;
                    }
                }

                // Buscar hacia abajo la siguiente tarea en la misma columna
                for (let i = rowIndex + 1; i < allRows.length; i++) {
                    if (allRows[i].cells[colIndex].style.backgroundColor || allRows[i].cells[colIndex].classList.contains('estado-inactivo')) {
                        nextTaskRow = i;
                        break;
                    }
                }

                // Si se encontró una tarea antes y una después, rellenamos el hueco
                if (prevTaskRow !== -1 && nextTaskRow !== -1) {
                    for (let i = prevTaskRow + 1; i < nextTaskRow; i++) {
                        allRows[i].cells[colIndex].classList.add('estado-inactivo');
                        allRows[i].cells[colIndex].style.backgroundColor = ''; // Limpiar color sólido
                    }
                    return; // Termina la ejecución aquí
                }
            }

            // LÓGICA DE PINTAR HACIA ABAJO
            const minutos = parseInt(prompt("Ingrese la duración en minutos:", "1"), 10);
            if (isNaN(minutos) || minutos <= 0) {
                return; // No hacer nada si la entrada no es válida
            }

            // Ejemplo de color de acción. Puedes cambiar esto por un selector.
            const colorDeAccion = 'lightblue';

            for (let i = 0; i < minutos; i++) {
                const targetRowIndex = rowIndex + i;
                if (targetRowIndex < allRows.length) { // Verificar que no nos salgamos de la tabla
                    const cellToPaint = allRows[targetRowIndex].cells[colIndex];
                    cellToPaint.style.backgroundColor = colorDeAccion;
                    cellToPaint.classList.remove('estado-inactivo'); // Quitar estilo de inactivo
                }
            }
        });

        // Generar la tabla cuando se carga la página
        document.addEventListener('DOMContentLoaded', createInitialGrid);
    </script>

</body>
</html>
