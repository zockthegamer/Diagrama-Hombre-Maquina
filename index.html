<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama Hombre-Máquina Avanzado</title>
    <style>
        :root {
            --borde-color: #dee2e6;
            --fondo-gris: #f8f9fa;
            --azul-principal: #0d6efd;
            --rojo-peligro: #dc3545;
            --texto-claro: #fff;
            --gris-oscuro: #6c757d;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--fondo-gris);
            color: #212529;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        main {
            width: 100%;
            max-width: 900px;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2, h3 {
            border-bottom: 2px solid var(--borde-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        .tabla-contenedor { max-height: 600px; overflow-y: auto; border: 1px solid var(--borde-color); }
        table { width: 100%; border-collapse: collapse; text-align: center; }
        th, td { border: 1px solid var(--borde-color); padding: 5px; min-width: 80px; height: 25px; font-size: 0.9rem; }
        td[data-accion] { font-weight: bold; font-size: 0.8em; vertical-align: middle; cursor: pointer; }
        thead th { position: sticky; top: 0; background-color: #e9ecef; }
        tbody td:first-child { font-weight: bold; background-color: var(--fondo-gris); }
        .celda-inactiva {
            background-image: repeating-linear-gradient(45deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.1) 8px, transparent 8px, transparent 16px);
        }

        /* NUEVO: Borde negro grueso */
        .borde-accion {
            border: 2px solid black !important;
        }
    </style>
</head>
<body>
    <main>
        <h2>Diagrama Hombre-Máquina Avanzado</h2>
        <div class="tabla-contenedor">
            <table id="tabla-actividades">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
    </main>

    <script>
    const tabla = document.getElementById('tabla-actividades');
    const thead = tabla.querySelector('thead');
    const tbody = tabla.querySelector('tbody');

    let columnas = ['Hombre'];
    let acciones = [];
    let accionActual = null;

    function generarTabla() {
        thead.innerHTML = '';
        tbody.innerHTML = '';
        const minutosTotales = 10; // ejemplo reducido
        const filaCabecera = document.createElement('tr');
        filaCabecera.innerHTML = `<th>Minuto</th>${columnas.map(n => `<th>${n}</th>`).join('')}`;
        thead.appendChild(filaCabecera);
        for (let i = 1; i <= minutosTotales; i++) {
            const fila = document.createElement('tr');
            fila.innerHTML = `<td>${i}</td>${columnas.map(() => `<td class="celda-inactiva"></td>`).join('')}`;
            tbody.appendChild(fila);
        }
    }

    // Pinta un bloque de ejemplo "D-M1"
    function pintarDemo() {
        const filas = tbody.rows;
        for (let i = 2; i <= 4; i++) {
            const celda = filas[i].cells[1];
            celda.className = '';
            celda.style.backgroundColor = 'blue';
            celda.style.color = 'white';
            celda.dataset.accion = 'D-M1';
            celda.textContent = (i === 3) ? 'D-M1' : '';
        }
        aplicarBordes();
    }

    // Aplica bordes al bloque entero de cada acción
    function aplicarBordes() {
        for (const fila of tbody.rows) {
            for (const celda of fila.cells) {
                celda.classList.remove('borde-accion');
            }
        }
        const accionesUnicas = [...new Set(
            Array.from(tbody.querySelectorAll('td[data-accion]')).map(c => c.dataset.accion)
        )];
        accionesUnicas.forEach(nombre => {
            const grupo = Array.from(tbody.querySelectorAll(`td[data-accion="${nombre}"]`));
            if (grupo.length > 0) {
                grupo.forEach(c => c.classList.add('borde-accion'));
            }
        });
    }

    // Evento: editar nombre de acción al hacer click
    tabla.addEventListener('click', (e) => {
        const celda = e.target;
        if (celda.dataset.accion) {
            const nombreActual = celda.dataset.accion;
            const nuevoNombre = prompt("Cambia el nombre de la acción:", nombreActual);
            if (nuevoNombre && nuevoNombre !== nombreActual) {
                // Cambiar en todas las celdas del mismo bloque
                tbody.querySelectorAll(`td[data-accion="${nombreActual}"]`).forEach(c => {
                    c.dataset.accion = nuevoNombre;
                    if (c.textContent === nombreActual) {
                        c.textContent = nuevoNombre;
                    }
                });
                aplicarBordes();
            }
        }
    });

    generarTabla();
    pintarDemo();
    </script>
</body>
</html>
